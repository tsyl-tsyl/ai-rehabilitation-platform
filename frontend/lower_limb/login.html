<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="login_title">登录 - 康复训练管理系统</title>
  <!-- 引入Tailwind CSS -->
  <script src="../libs/tailwindcss/tailwindcss.js"></script>
  <link rel="stylesheet" href="../libs/font-awesome/all.min.css">
   
  <!-- 配置Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#0066CC',
            secondary: '#1E88E5',
            accent: '#64B5F6',
            dark: '#0D47A1',
            light: '#E3F2FD',
            deep: '#0A3A7A',
            med: '#1565C0'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-gradient {
        background: linear-gradient(135deg, #1E88E5 0%, #0D47A1 100%);
      }
      .bg-grid {
        background-image: 
          radial-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
          linear-gradient(to bottom, rgba(10, 58, 122, 0.9), rgba(21, 101, 192, 0.7));
        background-size: 20px 20px, 100% 100%;
      }
      .border-glow {
        box-shadow: 0 0 15px rgba(100, 181, 246, 0.5);
      }
      .pulse-glow {
        animation: pulse-glow 2s infinite;
      }
      @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 0 15px rgba(100, 181, 246, 0.5); }
        50% { box-shadow: 0 0 25px rgba(100, 181, 246, 0.8); }
      }
      .fade-in {
        animation: fadeIn 1s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
    }
  </style>
</head>

<body class="bg-gradient-to-br from-deep to-med min-h-screen text-white overflow-x-hidden bg-grid">
  <!-- 顶部装饰线条 -->
  <div class="absolute top-0 left-0 right-0 h-1 bg-accent"></div>
  
  <!-- 页面容器 -->
  <div class="container mx-auto px-4 py-8 relative z-10">
    <!-- 顶部导航 -->
    <header class="flex justify-between items-center mb-12 fade-in">
      <div class="flex items-center">
        <a href="../index.html" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center mr-3 hover:bg-white/20 transition-colors" title="返回首页">
                    <i class="fas fa-home text-xl text-light"></i>
                </a>
        <div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center mr-3" style="display: none;">
          <i class="fa fa-heartbeat text-xl text-light"></i>
        </div>
        <div class="text-xl font-semibold" data-i18n="system_name">康复训练管理系统</div>
      </div>
      <div class="flex items-center">
        <div class="text-right mr-4">
          <div class="text-sm opacity-80" data-i18n="system_tagline">科学康复 · 精准评估 · 智能辅助</div>
        </div>
        <!-- 语言切换按钮 -->
        <button id="languageSwitch" class="px-3 py-2 bg-accent hover:bg-accent/80 rounded-lg text-sm transition-all duration-300 flex items-center">
          <span data-i18n="switchToEnglish">English</span>
        </button>
      </div>
    </header>
    
    <!-- 标题区域 -->
    <div class="text-center mb-16 relative fade-in">
      <h1 class="text-[clamp(1.8rem,5vw,3rem)] font-bold mb-3" data-i18n="login_title">用户登录</h1>
      <p class="text-lg opacity-80 max-w-2xl mx-auto mb-6" data-i18n="login_subtitle">请输入您的账户信息登录康复训练管理系统</p>
      <div class="w-32 h-1 bg-accent mx-auto rounded-full"></div>
    </div>
    
    <!-- 登录表单 -->
    <div class="max-w-md mx-auto">
      <div class="card-gradient rounded-2xl p-8 shadow-lg border border-accent/30 border-glow fade-in">
        <div class="text-center mb-8">
          <h1 class="text-3xl font-bold mb-2" data-i18n="login_title">用户登录</h1>
          <p class="text-light/80" data-i18n="login_form_subtitle">请输入您的账户信息登录系统</p>
        </div>
        
        <form id="loginForm">
          <div class="mb-6">
            <label for="username" class="block text-sm font-medium mb-2" data-i18n="username_label">用户名</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fa fa-user text-gray-400"></i>
              </div>
              <input type="text" id="username" class="w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-xl focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent" data-i18n-placeholder="username_placeholder" required>
            </div>
          </div>
          
          <div class="mb-6">
            <label for="password" class="block text-sm font-medium mb-2" data-i18n="password_label">密码</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fa fa-lock text-gray-400"></i>
              </div>
              <input type="password" id="password" class="w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-xl focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent" data-i18n-placeholder="password_placeholder" required>
            </div>
          </div>
          
          <div class="flex items-center justify-between mb-6" style="display:none;">
            <div class="flex items-center">
              <input type="checkbox" id="remember" class="w-4 h-4 bg-white/10 border border-white/20 rounded focus:ring-accent focus:ring-2">
              <label for="remember" class="ml-2 text-sm" data-i18n="remember_me">记住密码</label>
            </div>
            <a href="#" class="text-sm text-accent hover:underline" data-i18n="forgot_password" >忘记密码?</a>
          </div>
          
          <button type="submit" class="w-full py-3 bg-accent hover:bg-accent/80 rounded-xl transition-all duration-300 font-medium text-lg" data-i18n="login_button">
            登录系统
          </button>
        </form>
        
        <div class="mt-6 text-center">
          <p class="text-sm text-light/80" style="display:none;">
            <span data-i18n="no_account">还没有账户?</span>
            <a href="#" class="text-accent hover:underline ml-1" data-i18n="register_now">立即注册</a>
          </p>
        </div>
      </div>
    </div>
    
    <!-- 底部信息 -->
    <footer class="text-center pt-8 border-t border-white/10 fade-in mt-12">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <div class="flex items-center justify-center md:justify-start">
            <div class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center mr-2">
              <i class="fa fa-heartbeat text-sm text-light"></i>
            </div>
            <span class="font-semibold" data-i18n="system_name">康复训练管理系统</span>
          </div>
          <div class="text-sm opacity-70 mt-1" data-i18n="system_slogan">科技赋能康复，智能改善生活</div>
        </div>
        
        <div class="text-sm opacity-70" data-i18n="copyright">
          © 2025 康复训练管理系统 - 基于AI的精准康复解决方案
        </div>
      </div>
    </footer>
  </div>
  
  <!-- 背景装饰元素 -->
  <div class="absolute top-0 left-0 w-full h-full pointer-events-none">
    <div class="absolute top-10 left-10 w-40 h-40 rounded-full bg-accent/10 blur-3xl"></div>
    <div class="absolute bottom-10 right-10 w-60 h-60 rounded-full bg-primary/20 blur-3xl"></div>
    <div class="absolute top-1/2 left-1/4 w-32 h-32 rounded-full bg-accent/5 blur-3xl"></div>
  </div>

  <script src="../static/js/common.js"></script>
  <script src="../static/js/i18nManage.js"></script>
  
  <script>
 

    // 显示消息提示
    function showMessage(message, type = 'error') {
        const existingMessage = document.querySelector('.message-toast');
        if (existingMessage) {
            existingMessage.remove();
        }

        const messageEl = document.createElement('div');
        messageEl.className = `message-toast fixed top-4 right-4 p-4 rounded-lg z-50 transform transition-all duration-300 ${
            type === 'success' ? 'bg-green-500' : 'bg-red-500'
        } text-white shadow-lg`;
        messageEl.textContent = message;
        
        document.body.appendChild(messageEl);
        
        setTimeout(() => {
            messageEl.remove();
        }, 3000);
    }

    // 显示加载状态
    function setLoading(loading) {
        const submitBtn = document.querySelector('button[type="submit"]');
        if (loading) {
            submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>' + i18n.t('logging_in');
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-50');
        } else {
            submitBtn.innerHTML = i18n.t('login_button');
            submitBtn.disabled = false;
            submitBtn.classList.remove('opacity-50');
        }
    }

    // 登录请求
    async function login(username, password) {
        try {
            setLoading(true);
            
            const response = await fetch(`${API_BASE_URL}/api/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    username: username,
                    password: password
                })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.detail || i18n.t('login_failed'));
            }
            
            // 保存token和用户信息
            localStorage.setItem('access_token', data.access_token);
            localStorage.setItem('user_info', JSON.stringify(data.user_info));
            
            showMessage(i18n.t('login_successful'), 'success');
            
            setTimeout(() => {
                window.location.href = 'doctor.html';
            }, 1000);
            
        } catch (error) {
            console.error('登录错误:', error);
            showMessage(error.message || i18n.t('login_failed_check'));
        } finally {
            setLoading(false);
        }
    }

    // 检查是否已登录
    function checkLoginStatus() {
        const token = localStorage.getItem('access_token');
        if (token) {
            fetch(`${API_BASE_URL}/api/users/me`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => {
                if (response.ok) {
                    window.location.href = 'doctor.html';
                } else {
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('user_info');
                }
            })
            .catch(() => {
                localStorage.removeItem('access_token');
                localStorage.removeItem('user_info');
            });
        }
    }


    // 初始化页面
    document.addEventListener('DOMContentLoaded',async function() {
      
      await i18n.init();
          // 添加语言切换事件
  document.getElementById('languageSwitch').addEventListener('click', switchLanguage);
            // 添加登录表单提交事件
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value;
                
                if (!username) {
                    showMessage(i18n.t('please_enter_username'));
                    document.getElementById('username').focus();
                    return;
                }
                
                if (!password) {
                    showMessage(i18n.t('please_enter_password'));
                    document.getElementById('password').focus();
                    return;
                }
                
                login(username, password);
            });

            // 页面加载完成后执行
            document.body.classList.add('loaded');
            
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.classList.add('border-glow');
                });
                
                input.addEventListener('blur', function() {
                    this.parentElement.classList.remove('border-glow');
                });
            });
            
            const rememberCheckbox = document.getElementById('remember');
            const savedUsername = localStorage.getItem('remembered_username');
            if (savedUsername) {
                document.getElementById('username').value = savedUsername;
                rememberCheckbox.checked = true;
            }
            
            rememberCheckbox.addEventListener('change', function() {
                const username = document.getElementById('username').value;
                if (this.checked && username) {
                    localStorage.setItem('remembered_username', username);
                } else {
                    localStorage.removeItem('remembered_username');
                }
            });
            
            checkLoginStatus();
        });
 
  </script>
</body>
</html>