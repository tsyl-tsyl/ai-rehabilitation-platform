<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">æ¨¡å‹è®­ç»ƒ - MobileNetV2 ä¸Šè‚¢åº·å¤è®­ç»ƒç³»ç»Ÿ</title>
    <!-- ä½¿ç”¨æœ¬åœ° Tailwind CSS -->
    <script src="../libs/tailwindcss/tailwindcss.js"></script>
    <!-- ä½¿ç”¨æœ¬åœ° Chart.js -->
    <script src="../libs/chart/chart.js"></script>
    <!-- ä½¿ç”¨æœ¬åœ° Font Awesome -->
    <link rel="stylesheet" href="../libs/font-awesome/all.min.css">
    <!-- æœ¬åœ°å­—ä½“æ–‡ä»¶ç”± font-awesome.min.css è‡ªåŠ¨å¼•ç”¨ï¼Œæ— éœ€å•ç‹¬å¼•å…¥ -->
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0066CC',
                        secondary: '#1E88E5',
                        accent: '#64B5F6',
                        dark: '#0D47A1',
                        light: '#E3F2FD',
                        deep: '#0A3A7A',
                        med: '#1565C0'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                },
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .card-gradient {
                background: linear-gradient(135deg, #1E88E5 0%, #0D47A1 100%);
            }
            .border-glow {
                box-shadow: 0 0 15px rgba(100, 181, 246, 0.5);
            }
            .fade-in {
                animation: fadeIn 1s ease-in-out;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
        }
    </style>
    
    <style>
        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-container {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 6px;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 10px;
            transition: width 0.4s ease;
            width: 100%; /* ç¬¬äºŒæ­¥100% */
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .progress-step {
            text-align: center;
            flex: 1;
            position: relative;
            cursor: pointer;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 5px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .step-active .step-number {
            background: #4facfe;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
        }
        
        .step-label {
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .step-active .step-label {
            opacity: 1;
            font-weight: 600;
        }

        /* ä¸´æ—¶æ¶ˆæ¯æ ·å¼ */
        .temp-message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
            animation-fill-mode: forwards;
        }

        .temp-message.success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .temp-message.error {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .temp-message.info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e1e5e9;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0;
        }
        
        .modal-title {
            margin: 0;
            color: white;
            font-size: 1.5rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
            width: auto;
            padding: 5px;
            transition: transform 0.2s;
        }
        
        .close-btn:hover {
            transform: scale(1.1);
        }
        
        .training-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
            margin: 20px;
            border-radius: 10px;
        }
        
        .summary-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .summary-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .summary-label {
            color: #666;
            margin-top: 5px;
        }
        
        .training-history-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            color: #000000; /* é»‘è‰²å­—ä½“ */
        }
        
        .training-history-table th,
        .training-history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e1e5e9;
            color: #000000; /* é»‘è‰²å­—ä½“ */
        }
        
        .training-history-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        
        .training-history-table tr:hover {
            background: #f5f7ff;
        }

        /* å›¾è¡¨å®¹å™¨æ ·å¼ - æ”¾å¤§å›¾è¡¨ */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            height: 450px; /* å¢å¤§å›¾è¡¨é«˜åº¦ */
        }

        /* åŠ è½½æŒ‡ç¤ºå™¨ */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            outline: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        .input-field {
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #64B5F6;
            box-shadow: 0 0 0 2px rgba(100, 181, 246, 0.2);
        }
        
        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        /* è¯­è¨€åˆ‡æ¢æŒ‰é’®æ ·å¼ */
        .lang-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .lang-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .lang-btn.active {
            background: rgba(255, 255, 255, 0.3);
            font-weight: bold;
        }
        .lang-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
        }
        
        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-deep to-med min-h-screen text-white overflow-x-hidden">
    <!-- è¯­è¨€åˆ‡æ¢æŒ‰é’® 
    <div class="lang-switcher">
        <button class="lang-btn active" data-lang="zh-CN">ä¸­æ–‡</button>
        <button class="lang-btn" data-lang="en">English</button>
    </div>-->
 
    <!-- é¡¶éƒ¨è¿›åº¦æ¡ -->
    <div class="absolute top-0 left-0 right-0 h-1 bg-accent"></div>
    
    <div class="container mx-auto px-4 py-8 relative z-10">
        <!-- å¤´éƒ¨ -->
        <header class="flex justify-between items-center mb-8 fade-in">
            <div class="flex items-center">
                <a href="../index.html" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center mr-3 hover:bg-white/20 transition-colors" title="è¿”å›é¦–é¡µ">
                    <i class="fas fa-home text-xl text-light"></i>
                </a>
                <div class="text-xl font-semibold" data-i18n="systemName">MobileNetV2 ä¸Šè‚¢åº·å¤è®­ç»ƒç³»ç»Ÿ</div>
            </div>
            <div class="text-right">
                <div class="text-sm opacity-80" data-i18n="systemDescription">åŸºäºMediaPipeå§¿æ€ä¼°è®¡çš„ä¸Šè‚¢åº·å¤åŠ¨ä½œé‡‡é›†ä¸è®­ç»ƒå¹³å°</div>
               <button class="lang-btn " onclick="toggleLanguage()">
                    <span id="lang-text">English</span>
                </button>
            </div>
        </header>

        <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
        <div class="max-w-2xl mx-auto mb-8 fade-in">
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="progress-steps">
                <div class="progress-step" onclick="goToTraining()">
                    <div class="step-number">1</div>
                    <div class="step-label" data-i18n="step1">æ•°æ®é‡‡é›†</div>
                </div>
                <div class="progress-step step-active" onclick="window.location.href='tranTSF.html'">
                    <div class="step-number">2</div>
                    <div class="step-label" data-i18n="step2">æ¨¡å‹è®­ç»ƒ</div>
                </div>
            </div>
        </div>

        <!-- è®­ç»ƒé¢æ¿ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <!-- æ–°æ¨¡å‹è®­ç»ƒ -->
            <div class="card-gradient rounded-2xl p-6 shadow-lg border border-accent/30 border-glow fade-in">
                <div style="position:relative;">
                    <h2 class="text-2xl font-bold mb-4" style="text-align:center;" data-i18n="newTraining">ğŸš€ æ–°æ¨¡å‹è®­ç»ƒ</h2>
                    <span onclick="showTrainDataDetail()" style="position: absolute;top: 0;right: 0;margin-right: 18px;font-size: 1rem;cursor: pointer;z-index: 2;letter-spacing: 1px;user-select: none;background: rgba(255, 255, 255, 0.1);color: white;border: none;border-radius: 20px;padding: 8px 16px;" data-i18n="viewTrainingData">æŸ¥çœ‹è®­ç»ƒæ•°æ®</span>
                </div>
                  
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm mb-2 font-semibold" data-i18n="rehabCategory">åº·å¤åˆ†ç±»:</label>
                        <select id="category" class="input-field" disabled>
                            <option value="upper_limb" data-i18n="upperLimb">ä¸Šè‚¢åº·å¤ (Upper Limb)</option>
                            <option value="lower_limb" data-i18n="lowerLimb">ä¸‹è‚¢åº·å¤ (Lower Limb)</option>
                            <option value="aphasia" data-i18n="aphasia">è¨€è¯­åº·å¤ (Aphasia)</option>
                        </select>
                    </div>
                    <div hidden>
                        <label class="block text-sm mb-2 font-semibold" data-i18n="modelName">æ¨¡å‹åç§° (å¯é€‰):</label>
                        <input id="modelName" type="text" placeholder="ç•™ç©ºå°†è‡ªåŠ¨ç”Ÿæˆ" class="input-field">
                    </div>
                    <div>
                        <label class="block text-sm mb-2 font-semibold" data-i18n="learningRate">å­¦ä¹ ç‡ (Learning Rate):</label>
                        <input id="lr" type="number" value="0.001" step="0.0001" min="0.0001" class="input-field">
                    </div>
                    <div>
                        <label class="block text-sm mb-2 font-semibold" data-i18n="batchSize">æ‰¹æ¬¡å¤§å° (Batch Size):</label>
                        <input id="batch" type="number" value="8" min="1" class="input-field">
                    </div>
                    <div>
                        <label class="block text-sm mb-2 font-semibold" data-i18n="epochs">è®­ç»ƒè½®æ•° (Epochs):</label>
                        <input id="epoch" type="number" value="5" min="1" class="input-field">
                    </div>
                    <button id="trainBtn" onclick="startTraining()" class="btn btn-primary w-full py-3">
                        <i class="fas fa-play-circle mr-2"></i><span data-i18n="startTraining">å¼€å§‹è®­ç»ƒ</span>
                    </button>                    
                    <!-- æ•°æ®è¯¦æƒ…æ¨¡æ€æ¡† -->
                    <div class="modal" id="trainDataDetailModal">
                        <div class="modal-content" style="padding:0;max-width:700px;">
                            <div class="modal-header" style="background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);color:#fff;">
                                <h2 class="modal-title" data-i18n="trainingDataDetail">è®­ç»ƒæ•°æ®è¯¦æƒ…</h2>
                                <button class="close-btn" onclick="closeTrainDataDetailModal()">&times;</button>
                            </div>
                            <div id="trainDataDetailContent" style="color:#222;max-height:60vh;overflow-y:auto;padding:24px 32px 24px 32px;background:#f8f9fa;"></div>
                        </div>
                    </div>
                    <script>
        // ========== è®­ç»ƒæ•°æ®è¯¦æƒ…å¼¹çª— ========== 
        function showTrainDataDetail() { 
            const category = document.getElementById('category').value;
            const modal = document.getElementById('trainDataDetailModal');
            const content = document.getElementById('trainDataDetailContent');
            if (!modal || !content) return;
            content.innerHTML = '<div class="loader" style="display:inline-block;vertical-align:middle;"></div> <span data-i18n="loading">åŠ è½½ä¸­</span>...';
            modal.style.display = 'flex';
            // è‡ªåŠ¨è¯·æ±‚lower_limbæ•°æ®
            let apiUrl;
            if (category === 'lower_limb') {
                apiUrl = API_BASE_URL+'/pose_data_stats?category=lower_limb&detail=1';
            } else {
                apiUrl = `${API_BASE_URL}/pose_data_stats?category=${category}&detail=1`;
            }
            fetch(apiUrl)
                .then(res => res.json())
                .then(data => {
                    if (data.status === 'error') {
                        content.innerHTML = `<span style='color:red'>${data.message}</span>`;
                        return;
                    }
                    let html = `<div style='font-size:1.1em;line-height:1.8;'>`;
                    // æ–°å¢ï¼šæœ€æ–°æ ·æœ¬ä¿¡æ¯
                    let latestSampleHtml = '';
                    if (data.latest_sample) {
                        const s = data.latest_sample;
                        latestSampleHtml = `<br><span style='color:red;font-weight:bold;'><span data-i18n="latestSample">æœ€æ–°æ ·æœ¬</span>ï¼ˆ<span data-i18n="fileName">æ–‡ä»¶åç§°</span>ï¼š${s.file_name || ''}ã€<span data-i18n="action">åŠ¨ä½œ</span>ï¼š${s.action || ''}ã€<span data-i18n="sampleCount">æ ·æœ¬æ•°</span>ï¼š${s.count || ''}ï¼‰</span> &nbsp;`;
                    }
                    html += `<div style='margin-bottom:10px;'><b data-i18n="totalSamples">æ ·æœ¬æ€»æ•°</b>ï¼š <span style='color:#007aff;font-weight:bold;'>${data.total_samples || 0}</span> &nbsp; <b data-i18n="dataFiles">æ•°æ®æ–‡ä»¶æ•°</b>ï¼š <span style='color:#007aff;font-weight:bold;'>${data.total_files || 0}</span> ${latestSampleHtml}</div>`;
                    if (data.actions) {
                        html += `<div style='margin-bottom:10px;'><b data-i18n="actionDistribution">åŠ¨ä½œç±»åˆ«åˆ†å¸ƒ</b>ï¼š</b><ul style='margin-left:1em;margin-top:4px;'>`;
                        for (const [action, count] of Object.entries(data.actions)) {
                            html += `<li style='margin-bottom:2px;'>${action}ï¼š<span style='color:#007aff;font-weight:bold;'>${count}</span> <span data-i18n="items">æ¡</span></li>`;
                        }
                        html += `</ul></div>`;
                    }
                    if (data.files && Array.isArray(data.files)) {
                        html += `<div style='margin-bottom:8px;'><b data-i18n="fileDetails">æ–‡ä»¶è¯¦æƒ…</b>ï¼š</b></div>`;
                        html += `<div style='max-height:320px;overflow:auto;border:1px solid #e3e6ef;padding:8px 12px;background:#fff;border-radius:8px;'>`;
                        data.files.forEach(file => {
                            html += `<div style='margin-bottom:12px;border-bottom:1px dashed #e3e6ef;padding-bottom:8px;'>`;
                            html += `<div style='font-weight:bold;color:#333;'>${file.filename}</div>`;
                            html += `<div style='margin:2px 0 4px 0;'><span data-i18n="action">åŠ¨ä½œ</span>ï¼š<span style='color:#007aff;'>${file.action}</span> &nbsp; <span data-i18n="sampleCount">æ ·æœ¬æ•°</span>ï¼š<span style='color:#007aff;'>${file.total_samples}</span></div>`;
                            if (file.samples && Array.isArray(file.samples)) {
                                html += `<details style='margin-bottom:2px;'><summary style='cursor:pointer;'><span data-i18n="sampleDetails">æ ·æœ¬è¯¦æƒ…</span>ï¼ˆ${file.samples.length}<span data-i18n="items">æ¡</span>ï¼‰</summary><ul style='margin-left:1em;margin-top:4px;'>`;
                                file.samples.forEach((s, idx) => {
                                    html += `<li style='font-size:0.98em;margin-bottom:2px;'><span data-i18n="itemNo">ç¬¬</span>${idx+1}<span data-i18n="item">æ¡</span> | <span data-i18n="collectionTime">é‡‡é›†æ—¶é—´</span>: <span style='color:#555;'>${s.collection_time || '-'}</span> | landmarks<span data-i18n="count">æ•°</span>: <span style='color:#007aff;'>${(s.landmarks && Object.keys(s.landmarks).length) || 0}</span></li>`;
                                });
                                html += `</ul></details>`;
                            }
                            html += `</div>`;
                        });
                        html += `</div>`;
                    }
                    html += `</div>`;
                    content.innerHTML = html;
                    // æ›´æ–°æ¨¡æ€æ¡†å†…çš„ç¿»è¯‘
                    updateElementTranslations(content);
                })
                .catch(err => {
                    content.innerHTML = `<span style='color:red'><span data-i18n="loadFailed">åŠ è½½å¤±è´¥</span>: ${err}</span>`;
                    updateElementTranslations(content);
                });
        }
        function closeTrainDataDetailModal() {
            const modal = document.getElementById('trainDataDetailModal');
            if (modal) modal.style.display = 'none';
        }
        </script>
                </div>
               
                <div id="progressContainer" class="mt-4 hidden">
                    <div class="flex justify-between mb-2">
                        <span data-i18n="trainingProgress">è®­ç»ƒè¿›åº¦:</span>
                        <span id="progressText">0%</span>
                    </div>
                    <div class="w-full h-4 bg-white/10 rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-green-400 to-blue-500 transition-all duration-300" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div id="progressDetails" class="mt-2 text-sm text-center">Epoch: 0/0, Loss: -, Accuracy: -</div>
                </div>
            </div>

            <!-- è®­ç»ƒç›‘æ§ -->
            <div class="card-gradient rounded-2xl p-6 shadow-lg border border-accent/30 border-glow fade-in">
                <h2 class="text-2xl font-bold mb-4 text-center" data-i18n="trainingMonitor">ğŸ“Š è®­ç»ƒç›‘æ§</h2>
                <div class="chart-container">
                    <canvas id="combinedChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ç»§ç»­è®­ç»ƒé¢æ¿ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <!-- ç»§ç»­è®­ç»ƒ -->
            <div style="display: none;" class="card-gradient rounded-2xl p-6 shadow-lg border border-accent/30 border-glow fade-in">
                <h2 class="text-2xl font-bold mb-4 text-center" data-i18n="continueTraining">ğŸ”„ ç»§ç»­è®­ç»ƒ</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm mb-2 font-semibold" data-i18n="rehabCategory">åº·å¤åˆ†ç±»:</label>
                        <select id="continueCategory" onchange="updateModelList()" class="input-field">
                            <option value="upper_limb" data-i18n="upperLimb">ä¸Šè‚¢åº·å¤</option>
                            <option value="lower_limb" data-i18n="lowerLimb">ä¸‹è‚¢åº·å¤</option>
                            <option value="aphasia" data-i18n="aphasia">è¨€è¯­åº·å¤</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm mb-2 font-semibold" data-i18n="selectModel">é€‰æ‹©æ¨¡å‹:</label>
                        <select id="continueModelName" class="input-field">
                            <option value="" data-i18n="selectCategoryFirst">-- è¯·å…ˆé€‰æ‹©åˆ†ç±» --</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm mb-2 font-semibold" data-i18n="additionalEpochs">é¢å¤–è®­ç»ƒè½®æ•°:</label>
                        <input id="additionalEpochs" type="number" value="5" min="1" class="input-field">
                    </div>
                    <div>
                        <label class="block text-sm mb-2 font-semibold" data-i18n="newLearningRate">æ–°å­¦ä¹ ç‡ (å¯é€‰):</label>
                        <input id="newLr" type="number" step="0.0001" placeholder="ç•™ç©ºä¿æŒåŸå­¦ä¹ ç‡" class="input-field">
                    </div>
                    <button id="continueTrainBtn" onclick="continueTraining()" class="btn btn-secondary w-full py-3">
                        <i class="fas fa-sync-alt mr-2"></i><span data-i18n="continueTraining">ç»§ç»­è®­ç»ƒ</span>
                    </button>
                </div>
                <div id="continueStatus" class="mt-4 p-3 rounded-lg bg-white/10"></div>
            </div>

            <!-- ç»§ç»­è®­ç»ƒç›‘æ§ -->
            <div style="display: none;"  class="card-gradient rounded-2xl p-6 shadow-lg border border-accent/30 border-glow fade-in">
                <h2 class="text-2xl font-bold mb-4 text-center" data-i18n="continueTrainingMonitor">ğŸ“ˆ ç»§ç»­è®­ç»ƒç›‘æ§</h2>
                <div class="chart-container">
                    <canvas id="continueCombinedChart"></canvas>
                </div>
            </div>
        </div>

        <!-- æ¨¡å‹åˆ—è¡¨ -->
        <div class="card-gradient rounded-2xl p-6 shadow-lg border border-accent/30 border-glow fade-in">
            <h2 class="text-2xl font-bold mb-4 text-center" data-i18n="modelManagement">ğŸ’¾ æ¨¡å‹ç®¡ç†</h2>
            <div class="flex justify-between items-center mb-4">
                <button onclick="loadModels()" class="btn btn-primary">
                    <i class="fas fa-refresh mr-2"></i><span data-i18n="refreshModelList">åˆ·æ–°æ¨¡å‹åˆ—è¡¨</span>
                </button>
                <div class="text-sm opacity-80" data-i18n="savedModels">å·²ä¿å­˜æ¨¡å‹: <span id="modelCount">0</span> <span data-i18n="countUnit">ä¸ª</span></div>
            </div>
            <div id="modelsList" class="min-h-[200px]"></div>
        </div>
    </div>

    <!-- è®­ç»ƒè¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="trainingDetailModal">
        <div class="modal-content">
            <div class="modal-header" style="position:relative;">
                <h2 class="modal-title" data-i18n="trainingDetails">è®­ç»ƒè¯¦æƒ…</h2>
                <button class="close-btn" onclick="closeTrainingDetailModal()" style="position:absolute;right:20px;top:20px;z-index:10;font-size:2rem;background:rgba(0,0,0,0.08);color:#fff;border-radius:50%;width:40px;height:40px;line-height:36px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.08);border:none;">&times;</button>
            </div>
            <div id="modalModelInfo"></div>
            <div id="modalTrainingHistory"></div>
        </div>
        <!-- å·²ç§»é™¤é¦–æ¬¡è¿›å…¥è‡ªåŠ¨å¼¹å‡ºæ•°æ®è¯¦æƒ… -->
    </div>
<script src="../static/js/common.js"></script>
    <!-- å›½é™…åŒ–èµ„æºæ–‡ä»¶ -->
    <script>
        // å›½é™…åŒ–èµ„æºå®šä¹‰
        const i18nResources = {
            'zh-CN': {
                // é¡µé¢æ ‡é¢˜
                'pageTitle': 'æ¨¡å‹è®­ç»ƒ - MobileNetV2 ä¸Šè‚¢åº·å¤è®­ç»ƒç³»ç»Ÿ',
                'systemName': 'MobileNetV2 ä¸Šè‚¢åº·å¤è®­ç»ƒç³»ç»Ÿ',
                'systemDescription': 'åŸºäºMediaPipeå§¿æ€ä¼°è®¡çš„ä¸Šè‚¢åº·å¤åŠ¨ä½œé‡‡é›†ä¸è®­ç»ƒå¹³å°',
                
                // è¿›åº¦æ­¥éª¤
                'step1': 'æ•°æ®é‡‡é›†',
                'step2': 'æ¨¡å‹è®­ç»ƒ',

                // è¯­è¨€åˆ‡æ¢æŒ‰é’®
                langText: 'English',
                
                // æ–°æ¨¡å‹è®­ç»ƒ
                'newTraining': 'ğŸš€ æ¨¡å‹è®­ç»ƒ',
                'viewTrainingData': 'è®­ç»ƒæ•°æ®',
                'rehabCategory': 'åº·å¤åˆ†ç±»:',
                'upperLimb': 'ä¸Šè‚¢åº·å¤ (Upper Limb)',
                'lowerLimb': 'ä¸‹è‚¢åº·å¤ (Lower Limb)',
                'aphasia': 'è¨€è¯­åº·å¤ (Aphasia)',
                'modelName': 'æ¨¡å‹åç§° (å¯é€‰):',
                'learningRate': 'å­¦ä¹ ç‡ (Learning Rate):',
                'batchSize': 'æ‰¹æ¬¡å¤§å° (Batch Size):',
                'epochs': 'è®­ç»ƒè½®æ•° (Epochs):',
                'startTraining': 'å¼€å§‹è®­ç»ƒ',
                
                // è®­ç»ƒç›‘æ§
                'trainingMonitor': 'ğŸ“Š è®­ç»ƒç›‘æ§',
                'trainingProgress': 'è®­ç»ƒè¿›åº¦:',
                
                // ç»§ç»­è®­ç»ƒ
                'continueTraining': 'ğŸ”„ ç»§ç»­è®­ç»ƒ',
                'selectModel': 'é€‰æ‹©æ¨¡å‹:',
                'selectCategoryFirst': '-- è¯·å…ˆé€‰æ‹©åˆ†ç±» --',
                'additionalEpochs': 'é¢å¤–è®­ç»ƒè½®æ•°:',
                'newLearningRate': 'æ–°å­¦ä¹ ç‡ (å¯é€‰):',
                
                // ç»§ç»­è®­ç»ƒç›‘æ§
                'continueTrainingMonitor': 'ğŸ“ˆ ç»§ç»­è®­ç»ƒç›‘æ§',
                
                // æ¨¡å‹ç®¡ç†
                'modelManagement': 'ğŸ’¾ æ¨¡å‹ç®¡ç†',
                'refreshModelList': 'åˆ·æ–°æ¨¡å‹åˆ—è¡¨',
                'savedModels': 'å·²ä¿å­˜æ¨¡å‹:',
                'countUnit': 'ä¸ª',
                
                // è®­ç»ƒè¯¦æƒ…
                'trainingDetails': 'è®­ç»ƒè¯¦æƒ…',
                
                // è®­ç»ƒæ•°æ®è¯¦æƒ…
                'trainingDataDetail': 'è®­ç»ƒæ•°æ®è¯¦æƒ…',
                'loading': 'åŠ è½½ä¸­',
                'totalSamples': 'æ ·æœ¬æ€»æ•°',
                'dataFiles': 'æ•°æ®æ–‡ä»¶æ•°',
                'latestSample': 'æœ€æ–°æ ·æœ¬',
                'fileName': 'æ–‡ä»¶åç§°',
                'action': 'åŠ¨ä½œ',
                'sampleCount': 'æ ·æœ¬æ•°',
                'actionDistribution': 'åŠ¨ä½œç±»åˆ«åˆ†å¸ƒ',
                'items': 'æ¡',
                'fileDetails': 'æ–‡ä»¶è¯¦æƒ…',
                'sampleDetails': 'æ ·æœ¬è¯¦æƒ…',
                'itemNo': 'ç¬¬',
                'item': 'æ¡',
                'collectionTime': 'é‡‡é›†æ—¶é—´',
                'count': 'æ•°',
                'loadFailed': 'åŠ è½½å¤±è´¥',
                
                // é€šç”¨
                'noModels': 'æš‚æ— ä¿å­˜çš„æ¨¡å‹',
                'unknownModel': 'æœªçŸ¥æ¨¡å‹',
                'unknownCategory': 'æœªçŸ¥åˆ†ç±»',
                'unknownDate': 'æœªçŸ¥æ—¥æœŸ',
                'accuracy': 'å‡†ç¡®ç‡:',
                'loss': 'æŸå¤±:',
                'trainingDate': 'è®­ç»ƒæ—¥æœŸ:',
                'batchSize': 'æ‰¹æ¬¡å¤§å°:',
                'modelArchitecture': 'æ¨¡å‹æ¶æ„:',
                'noTrainingHistory': 'æš‚æ— è®­ç»ƒå†å²æ•°æ®',
                'trainingHistory': 'è®­ç»ƒå†å²',
                'timestamp': 'æ—¶é—´æˆ³',
                'confirmDelete': 'ç¡®å®šè¦åˆ é™¤æ¨¡å‹',
                'deleteSuccess': 'åˆ é™¤æˆåŠŸ',
                'deleteFailed': 'åˆ é™¤å¤±è´¥',
                'publishSuccess': 'å·²å‘å¸ƒï¼Œå¯åœ¨åº·å¤é¡µé¢ä½¿ç”¨'
            },
            'en-US': {
                // é¡µé¢æ ‡é¢˜
                'pageTitle': 'Model Training - MobileNetV2 Upper Limb Rehabilitation Training System',
                'systemName': 'MobileNetV2 Upper Limb Rehabilitation Training System',
                'systemDescription': 'Upper limb rehabilitation action collection and training platform based on MediaPipe pose estimation',
                
                // è¿›åº¦æ­¥éª¤
                'step1': 'Data Collection',
                'step2': 'Model Training',

                langText: 'ä¸­æ–‡',
                
                // æ–°æ¨¡å‹è®­ç»ƒ
                'newTraining': 'ğŸš€ Model Training',
                'viewTrainingData': 'Training Data',
                'rehabCategory': 'Rehabilitation Category:',
                'upperLimb': 'Upper Limb Rehabilitation',
                'lowerLimb': 'Lower Limb Rehabilitation',
                'aphasia': 'Aphasia Rehabilitation',
                'modelName': 'Model Name (Optional):',
                'learningRate': 'Learning Rate:',
                'batchSize': 'Batch Size:',
                'epochs': 'Training Epochs:',
                'startTraining': 'Start Training',
                
                // è®­ç»ƒç›‘æ§
                'trainingMonitor': 'ğŸ“Š Training Monitor',
                'trainingProgress': 'Training Progress:',
                
                // ç»§ç»­è®­ç»ƒ
                'continueTraining': 'ğŸ”„ Continue Training',
                'selectModel': 'Select Model:',
                'selectCategoryFirst': '-- Please select category first --',
                'additionalEpochs': 'Additional Epochs:',
                'newLearningRate': 'New Learning Rate (Optional):',
                
                // ç»§ç»­è®­ç»ƒç›‘æ§
                'continueTrainingMonitor': 'ğŸ“ˆ Continue Training Monitor',
                
                // æ¨¡å‹ç®¡ç†
                'modelManagement': 'ğŸ’¾ Model Management',
                'refreshModelList': 'Refresh Model List',
                'savedModels': 'Saved Models:',
                'countUnit': '',
                
                // è®­ç»ƒè¯¦æƒ…
                'trainingDetails': 'Training Details',
                
                // è®­ç»ƒæ•°æ®è¯¦æƒ…
                'trainingDataDetail': 'Training Data Details',
                'loading': 'Loading',
                'totalSamples': 'Total Samples',
                'dataFiles': 'Data Files',
                'latestSample': 'Latest Sample',
                'fileName': 'File Name',
                'action': 'Action',
                'sampleCount': 'Sample Count',
                'actionDistribution': 'Action Category Distribution',
                'items': 'items',
                'fileDetails': 'File Details',
                'sampleDetails': 'Sample Details',
                'itemNo': 'Item',
                'item': '',
                'collectionTime': 'Collection Time',
                'count': 'Count',
                'loadFailed': 'Load Failed',
                
                // é€šç”¨
                'noModels': 'No saved models',
                'unknownModel': 'Unknown Model',
                'unknownCategory': 'Unknown Category',
                'unknownDate': 'Unknown Date',
                'accuracy': 'Accuracy:',
                'loss': 'Loss:',
                'trainingDate': 'Training Date:',
                'batchSize': 'Batch Size:',
                'modelArchitecture': 'Model Architecture:',
                'noTrainingHistory': 'No training history data',
                'trainingHistory': 'Training History',
                'timestamp': 'Timestamp',
                'confirmDelete': 'Are you sure you want to delete the model',
                'deleteSuccess': 'Deleted successfully',
                'deleteFailed': 'Delete failed',
                'publishSuccess': 'Published, available on the rehabilitation page'
            }
        };

        // å½“å‰è¯­è¨€
        let currentLanguage = localStorage.getItem('languagePreference') || 'zh-CN';

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en-US' ? 'zh-CN' : 'en-US';
            localStorage.setItem('languagePreference', currentLanguage);
           // updateLanguage();
           location.reload();
        }

        // åˆå§‹åŒ–è¯­è¨€
        function initLanguage() {
            // ä»localStorageè·å–ä¿å­˜çš„è¯­è¨€è®¾ç½®
            const savedLang = localStorage.getItem('languagePreference');
            if (savedLang && (savedLang === 'zh-CN' || savedLang === 'en-US')) {
                currentLanguage = savedLang;
            }
            
            const langTexttag = document.getElementById('lang-text');
            if (langTexttag) langTexttag.textContent = i18nResources[currentLanguage].langText;
            // æ›´æ–°è¯­è¨€æŒ‰é’®çŠ¶æ€
           // updateLanguageButtons();
            
            // åº”ç”¨ç¿»è¯‘
            applyTranslations();
        }

        // æ›´æ–°è¯­è¨€æŒ‰é’®çŠ¶æ€
        function updateLanguageButtons() {
            const buttons = document.querySelectorAll('.lang-btn');
            buttons.forEach(btn => {
                if (btn.getAttribute('data-lang') === currentLanguage) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // åº”ç”¨ç¿»è¯‘åˆ°é¡µé¢
        function applyTranslations() {
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = i18nResources[currentLanguage]['pageTitle'];
            
            // æ›´æ–°æ‰€æœ‰å¸¦æœ‰data-i18nå±æ€§çš„å…ƒç´ 
            const elements = document.querySelectorAll('[data-i18n]');
            elements.forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (i18nResources[currentLanguage][key]) {
                    element.textContent = i18nResources[currentLanguage][key];
                }
            });
            
            // æ›´æ–°placeholder
            const placeholders = document.querySelectorAll('[data-i18n-placeholder]');
            placeholders.forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                if (i18nResources[currentLanguage][key]) {
                    element.setAttribute('placeholder', i18nResources[currentLanguage][key]);
                }
            });
            
            // æ›´æ–°é€‰é¡¹
            const options = document.querySelectorAll('option[data-i18n]');
            options.forEach(option => {
                const key = option.getAttribute('data-i18n');
                if (i18nResources[currentLanguage][key]) {
                    option.textContent = i18nResources[currentLanguage][key];
                }
            });
        }

        // æ›´æ–°ç‰¹å®šå…ƒç´ çš„ç¿»è¯‘
        function updateElementTranslations(element) {
            const elements = element.querySelectorAll('[data-i18n]');
            elements.forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (i18nResources[currentLanguage][key]) {
                    el.textContent = i18nResources[currentLanguage][key];
                }
            });
        }

         

     function goToTraining() {
        const category = document.getElementById('category').value;
            window.location.href = `../${category}/index.html`;
        }
    </script>

    <script>
        // å…¨å±€å˜é‡å£°æ˜
        let combinedChart = null;
        let continueCombinedChart = null;

        // ========== å›¾è¡¨åˆå§‹åŒ– ==========
        function initializeCharts() {
            // ç­‰å¾…Chart.jsåŠ è½½å®Œæˆ
            if (typeof Chart === 'undefined') {
                console.error('Chart.js æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                setTimeout(initializeCharts, 100);
                return;
            }

            const combinedCtx = document.getElementById('combinedChart');
            const continueCombinedCtx = document.getElementById('continueCombinedChart');
            
            if (combinedCtx) {
                combinedChart = new Chart(combinedCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: currentLanguage === 'zh-CN' ? 'è®­ç»ƒæŸå¤±' : 'Training Loss',
                                data: [],
                                borderColor: 'rgb(239, 68, 68)',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                yAxisID: 'y'
                            },
                            {
                                label: currentLanguage === 'zh-CN' ? 'è®­ç»ƒå‡†ç¡®ç‡' : 'Training Accuracy',
                                data: [],
                                borderColor: 'rgb(34, 197, 94)',
                                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: { 
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: currentLanguage === 'zh-CN' ? 'è®­ç»ƒè¿›åº¦ç›‘æ§' : 'Training Progress Monitor',
                                font: {
                                    size: 16
                                }
                            },
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: currentLanguage === 'zh-CN' ? 'æŸå¤±å€¼' : 'Loss Value'
                                },
                                beginAtZero: true
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: currentLanguage === 'zh-CN' ? 'å‡†ç¡®ç‡ (%)' : 'Accuracy (%)'
                                },
                                beginAtZero: true,
                                max: 100,
                                grid: {
                                    drawOnChartArea: false,
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: currentLanguage === 'zh-CN' ? 'è®­ç»ƒè½®æ¬¡' : 'Training Epochs'
                                }
                            }
                        }
                    }
                });
            }

            if (continueCombinedCtx) {
                continueCombinedChart = new Chart(continueCombinedCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: currentLanguage === 'zh-CN' ? 'è®­ç»ƒæŸå¤±' : 'Training Loss',
                                data: [],
                                borderColor: 'rgb(239, 68, 68)',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                yAxisID: 'y'
                            },
                            {
                                label: currentLanguage === 'zh-CN' ? 'è®­ç»ƒå‡†ç¡®ç‡' : 'Training Accuracy',
                                data: [],
                                borderColor: 'rgb(34, 197, 94)',
                                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: currentLanguage === 'zh-CN' ? 'ç»§ç»­è®­ç»ƒè¿›åº¦' : 'Continue Training Progress',
                                font: {
                                    size: 16
                                }
                            },
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: currentLanguage === 'zh-CN' ? 'æŸå¤±å€¼' : 'Loss Value'
                                },
                                beginAtZero: true
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: currentLanguage === 'zh-CN' ? 'å‡†ç¡®ç‡ (%)' : 'Accuracy (%)'
                                },
                                beginAtZero: true,
                                max: 100,
                                grid: {
                                    drawOnChartArea: false,
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: currentLanguage === 'zh-CN' ? 'è®­ç»ƒè½®æ¬¡' : 'Training Epochs'
                                }
                            }
                        }
                    }
                });
            }
        }

        // ========== è®­ç»ƒåŠŸèƒ½ ==========
        // ========== è®­ç»ƒå®Œæˆå¼¹çª— ========== 
        function showTrainResultModal(modelName, accuracy, loss, callback) {
            // åˆ›å»ºå¼¹çª—
            let modal = document.getElementById('trainResultModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'trainResultModal';
                modal.className = 'modal';
                modal.innerHTML = `
                <div class="modal-content" style="max-width:420px;padding:0;box-shadow:0 8px 32px rgba(0,0,0,0.18);border-radius:18px;overflow:hidden;">
                    <div class="modal-header" style="background:linear-gradient(135deg,#43b244 0%,#4facfe 100%);color:#fff;border-radius:18px 18px 0 0;box-shadow:0 2px 8px rgba(34,197,94,0.08);">
                        <h2 class="modal-title" style="font-size:1.35em;letter-spacing:1px;">ğŸ‰ ${currentLanguage === 'zh-CN' ? 'è®­ç»ƒå®Œæˆ' : 'Training Complete'}</h2>
                        <button class="close-btn" style="color:#fff;font-size:28px;top:8px;right:12px;" onclick="closeTrainResultModal()">&times;</button>
                    </div>
                    <div style="padding:36px 36px 28px 36px;text-align:left;background:linear-gradient(135deg,#f8f9fa 60%,#e3f2fd 100%);">
                        <div style="font-size:1.08em;margin-bottom:16px;letter-spacing:1px;color:#222;"><b>${currentLanguage === 'zh-CN' ? 'æ¨¡å‹åç§°' : 'Model Name'}ï¼š</b><span style='color:#222;font-weight:500;'>${modelName}</span></div>
                        <div style="margin-bottom:12px;font-size:1.08em;color:#222;"><b>${currentLanguage === 'zh-CN' ? 'å‡†ç¡®ç‡' : 'Accuracy'}ï¼š</b><span style='color:#222;font-weight:500;'>${accuracy}%</span></div>
                        <div style="margin-bottom:24px;font-size:1.08em;color:#222;"><b>${currentLanguage === 'zh-CN' ? 'æŸå¤±' : 'Loss'}ï¼š</b><span style='color:#222;font-weight:500;'>${loss}</span></div>
                        <button id=\"trainResultOkBtn\" class=\"btn btn-primary\" style=\"width:120px;font-size:1.08em;box-shadow:0 2px 8px #4facfe33;\">${currentLanguage === 'zh-CN' ? 'ç¡®å®š' : 'OK'}</button>
                        <div id="trainResultAutoTip" style="margin-top:18px;font-size:0.98em;color:#888;text-align:right;display:none;">${currentLanguage === 'zh-CN' ? '10ç§’åè‡ªåŠ¨åˆ·æ–°' : 'Auto refresh in 10 seconds'}</div>
                    </div>
                </div>`;
                document.body.appendChild(modal);
            }
            modal.style.display = 'flex';
            // å…³é—­å›è°ƒ
            const okBtn = document.getElementById('trainResultOkBtn');
            let autoTimer = null;
            if (okBtn) {
                okBtn.onclick = function() {
                    if (autoTimer) clearTimeout(autoTimer);
                    modal.style.display = 'none';
                    window.location.reload();
                };
            }
            // 10ç§’åè‡ªåŠ¨åˆ·æ–°
            const autoTip = document.getElementById('trainResultAutoTip');
            /*autoTimer = setTimeout(() => {
                if (modal.style.display !== 'none') {
                    if (autoTip) autoTip.style.display = '';
                    setTimeout(() => {
                        modal.style.display = 'none';
                        window.location.reload();
                    }, 1000);
                }
            }, 9000);*/
            window.closeTrainResultModal = function() {
                if (autoTimer) clearTimeout(autoTimer);
                modal.style.display = 'none';
            }
        }
        async function startTraining() {
            const lr = parseFloat(document.getElementById('lr').value);
            const batch = parseInt(document.getElementById('batch').value);
            const epoch = parseInt(document.getElementById('epoch').value);
            const category = document.getElementById('category').value;
            const modelName = document.getElementById('modelName').value || null;

            const trainBtn = document.getElementById('trainBtn');
            if (!trainBtn) return;
            
            trainBtn.disabled = true;
            trainBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>' + (currentLanguage === 'zh-CN' ? 'è®­ç»ƒä¸­...' : 'Training...');

            const statusDiv = document.getElementById('status');
            if (statusDiv) {
                statusDiv.className = 'bg-blue-500/20 text-blue-300';
                statusDiv.textContent = currentLanguage === 'zh-CN' ? "è®­ç»ƒä¸­..." : "Training...";
            }

            // æ˜¾ç¤ºè¿›åº¦æ¡
            const progressContainer = document.getElementById('progressContainer');
            if (progressContainer) {
                progressContainer.style.display = 'block';
            }

            // é‡ç½®å›¾è¡¨
            if (combinedChart) {
                combinedChart.data.labels = [];
                combinedChart.data.datasets[0].data = [];
                combinedChart.data.datasets[1].data = [];
                combinedChart.update();
            }
            try {
                const res = await fetch(API_BASE_URL+"/train", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ lr, batch, epoch, category, model_name: modelName })
                });
                if (!res.ok) {
                    throw new Error(`HTTPé”™è¯¯! çŠ¶æ€ç : ${res.status}`);
                }
                const reader = res.body.getReader();
                const decoder = new TextDecoder();
                let buffer = "";
                let finalModelInfo = null;
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split("\n");
                    buffer = lines.pop() || "";
                    for (const line of lines) {
                        if (line.startsWith("data:")) {
                            try {
                                const jsonStr = line.slice(5).trim();
                                if (!jsonStr) continue;
                                const data = JSON.parse(jsonStr);
                                if (data.epoch && data.loss !== undefined) {
                                    const progressFill = document.getElementById('progressFill');
                                    const progressText = document.getElementById('progressText');
                                    const progressDetails = document.getElementById('progressDetails');
                                    if (progressFill) progressFill.style.width = `${data.progress}%`;
                                    if (progressText) progressText.textContent = `${data.progress.toFixed(1)}%`;
                                    if (progressDetails) {
                                        progressDetails.textContent = 
                                            `Epoch: ${data.epoch}/${data.total_epochs}, Loss: ${data.loss.toFixed(4)}, Accuracy: ${(data.accuracy * 100).toFixed(2)}%`;
                                    }
                                    if (combinedChart) {
                                        const epochLabel = `Epoch ${data.epoch}`;
                                        combinedChart.data.labels.push(epochLabel);
                                        combinedChart.data.datasets[0].data.push(data.loss);
                                        // ä¿®æ­£ï¼šå‡†ç¡®ç‡ä¹˜ä»¥100
                                        combinedChart.data.datasets[1].data.push(data.accuracy * 100);
                                        combinedChart.update();
                                    }
                                }
                                if (data.status === 'completed') {
                                    debugger;
                                    finalModelInfo = data;
                                    if (statusDiv) {
                                        statusDiv.className = 'bg-green-500/20 text-green-300';
                                        statusDiv.textContent = currentLanguage === 'zh-CN' ? 
                                            `è®­ç»ƒå®Œæˆï¼æœ€ç»ˆæŸå¤±: ${data.final_loss.toFixed(4)}, å‡†ç¡®ç‡: ${(data.final_accuracy * 100).toFixed(2)}%` :
                                            `Training complete! Final loss: ${data.final_loss.toFixed(4)}, Accuracy: ${(data.final_accuracy * 100).toFixed(2)}%`;
                                    }
                                    trainBtn.disabled = false;
                                    trainBtn.innerHTML = '<i class="fas fa-play-circle mr-2"></i>' + (currentLanguage === 'zh-CN' ? 'å¼€å§‹è®­ç»ƒ' : 'Start Training');
                                    await loadModels();
                                     
                                    // æ–°å¢ï¼šå¼¹çª—æç¤ºæ¨¡å‹åç§°ã€å‡†ç¡®ç‡å’ŒæŸå¤±ï¼Œç‚¹å‡»ç¡®å®šååˆ·æ–°
                                    showTrainResultModal(data.training_config.model_name || modelName || '', (data.final_accuracy * 100).toFixed(2), data.final_loss.toFixed(4));
                                }
                                if (data.error) {
                                    console.error("è®­ç»ƒé”™è¯¯:", data.error);
                                    if (statusDiv) {
                                        statusDiv.className = 'bg-red-500/20 text-red-300';
                                        statusDiv.textContent = currentLanguage === 'zh-CN' ? `è®­ç»ƒé”™è¯¯: ${data.error}` : `Training error: ${data.error}`;
                                    }
                                    trainBtn.disabled = false;
                                    trainBtn.innerHTML = '<i class="fas fa-play-circle mr-2"></i>' + (currentLanguage === 'zh-CN' ? 'å¼€å§‹è®­ç»ƒ' : 'Start Training');
                                    showTemporaryMessage(currentLanguage === 'zh-CN' ? `è®­ç»ƒé”™è¯¯: ${data.error}` : `Training error: ${data.error}`, 'error');
                                }
                                if (data.warning) {
                                    console.warn("è®­ç»ƒè­¦å‘Š:", data.warning);
                                    showTemporaryMessage(data.warning, 'info');
                                }
                            } catch (e) {
                                console.error("è§£ææ•°æ®é”™è¯¯:", e, "åŸå§‹æ•°æ®:", line);
                            }
                        }
                    }
                }
            } catch (error) {
                console.error("è®­ç»ƒè¯·æ±‚é”™è¯¯:", error);
                if (statusDiv) {
                    statusDiv.className = 'bg-red-500/20 text-red-300';
                    statusDiv.textContent = currentLanguage === 'zh-CN' ? `è®­ç»ƒå¤±è´¥: ${error.message}` : `Training failed: ${error.message}`;
                }
                trainBtn.disabled = false;
                trainBtn.innerHTML = '<i class="fas fa-play-circle mr-2"></i>' + (currentLanguage === 'zh-CN' ? 'å¼€å§‹è®­ç»ƒ' : 'Start Training');
                showTemporaryMessage(currentLanguage === 'zh-CN' ? 'è®­ç»ƒå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥' : 'Training failed, please check network connection', 'error');
            }
        }

        // ========== ç»§ç»­è®­ç»ƒåŠŸèƒ½ ==========
        async function continueTraining() {
            const modelName = document.getElementById('continueModelName').value;
            const category = document.getElementById('continueCategory').value;
            const additionalEpochs = parseInt(document.getElementById('additionalEpochs').value);
            const newLr = document.getElementById('newLr').value ? parseFloat(document.getElementById('newLr').value) : null;

            if (!modelName) {
                const continueStatus = document.getElementById('continueStatus');
                if (continueStatus) {
                    continueStatus.className = 'bg-red-500/20 text-red-300';
                    continueStatus.textContent = currentLanguage === 'zh-CN' ? "è¯·é€‰æ‹©æ¨¡å‹" : "Please select a model";
                }
                return;
            }

            const continueTrainBtn = document.getElementById('continueTrainBtn');
            if (!continueTrainBtn) return;
            
            continueTrainBtn.disabled = true;
            continueTrainBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>' + (currentLanguage === 'zh-CN' ? 'ç»§ç»­è®­ç»ƒä¸­...' : 'Continuing training...');

            const statusDiv = document.getElementById('continueStatus');
            if (statusDiv) {
                statusDiv.className = 'bg-blue-500/20 text-blue-300';
                statusDiv.textContent = currentLanguage === 'zh-CN' ? "ç»§ç»­è®­ç»ƒä¸­..." : "Continuing training...";
            }

            // é‡ç½®ç»§ç»­è®­ç»ƒå›¾è¡¨
            if (continueCombinedChart) {
                continueCombinedChart.data.labels = [];
                continueCombinedChart.data.datasets[0].data = [];
                continueCombinedChart.data.datasets[1].data = [];
                continueCombinedChart.update();
            }

            try {
                const res = await fetch(API_BASE_URL+"/continue_train", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ 
                        model_name: modelName, 
                        category: category,
                        additional_epochs: additionalEpochs, 
                        new_lr: newLr 
                    })
                });
                if (!res.ok) {
                    throw new Error(`HTTPé”™è¯¯! çŠ¶æ€ç : ${res.status}`);
                }
                const reader = res.body.getReader();
                const decoder = new TextDecoder();
                let buffer = "";
                let finalModelInfo = null;
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split("\n");
                    buffer = lines.pop() || "";
                    for (const line of lines) {
                        if (line.startsWith("data:")) {
                            try {
                                const jsonStr = line.slice(5).trim();
                                if (!jsonStr) continue;
                                const data = JSON.parse(jsonStr);
                                if (data.epoch && data.loss !== undefined) {
                                    if (continueCombinedChart) {
                                        const epochLabel = `Epoch ${data.current_total_epochs || data.epoch}`;
                                        continueCombinedChart.data.labels.push(epochLabel);
                                        continueCombinedChart.data.datasets[0].data.push(data.loss);
                                        // ä¿®æ­£ï¼šå‡†ç¡®ç‡ä¹˜ä»¥100
                                        continueCombinedChart.data.datasets[1].data.push(data.accuracy * 100);
                                        continueCombinedChart.update();
                                    }
                                }
                                if (data.status === 'continued_completed') {
                                    finalModelInfo = data;
                                    if (statusDiv) {
                                        statusDiv.className = 'bg-green-500/20 text-green-300';
                                        statusDiv.textContent = currentLanguage === 'zh-CN' ? 
                                            `ç»§ç»­è®­ç»ƒå®Œæˆï¼æ–°æ¨¡å‹: ${data.continued_model_name}` :
                                            `Continue training complete! New model: ${data.continued_model_name}`;
                                    }
                                    continueTrainBtn.disabled = false;
                                    continueTrainBtn.innerHTML = '<i class="fas fa-sync-alt mr-2"></i>' + (currentLanguage === 'zh-CN' ? 'ç»§ç»­è®­ç»ƒ' : 'Continue Training');
                                    await loadModels();
                                    // æ–°å¢ï¼šå¼¹çª—æç¤ºæ¨¡å‹åç§°ã€å‡†ç¡®ç‡å’ŒæŸå¤±ï¼Œç‚¹å‡»ç¡®å®šååˆ·æ–°
                                    showTrainResultModal(data.continued_model_name || modelName || '', (data.final_accuracy * 100).toFixed(2), data.final_loss.toFixed(4));
                                } else if (data.error) {
                                    if (statusDiv) {
                                        statusDiv.className = 'bg-red-500/20 text-red-300';
                                        statusDiv.textContent = currentLanguage === 'zh-CN' ? `é”™è¯¯: ${data.error}` : `Error: ${data.error}`;
                                    }
                                    continueTrainBtn.disabled = false;
                                    continueTrainBtn.innerHTML = '<i class="fas fa-sync-alt mr-2"></i>' + (currentLanguage === 'zh-CN' ? 'ç»§ç»­è®­ç»ƒ' : 'Continue Training');
                                    showTemporaryMessage(currentLanguage === 'zh-CN' ? `è®­ç»ƒé”™è¯¯: ${data.error}` : `Training error: ${data.error}`, 'error');
                                }
                            } catch (e) {
                                console.error("è§£ææ•°æ®é”™è¯¯:", e, "åŸå§‹æ•°æ®:", line);
                            }
                        }
                    }
                }
            } catch (error) {
                console.error("ç»§ç»­è®­ç»ƒè¯·æ±‚é”™è¯¯:", error);
                if (statusDiv) {
                    statusDiv.className = 'bg-red-500/20 text-red-300';
                    statusDiv.textContent = currentLanguage === 'zh-CN' ? `ç»§ç»­è®­ç»ƒå¤±è´¥: ${error.message}` : `Continue training failed: ${error.message}`;
                }
                continueTrainBtn.disabled = false;
                continueTrainBtn.innerHTML = '<i class="fas fa-sync-alt mr-2"></i>' + (currentLanguage === 'zh-CN' ? 'ç»§ç»­è®­ç»ƒ' : 'Continue Training');
                showTemporaryMessage(currentLanguage === 'zh-CN' ? 'ç»§ç»­è®­ç»ƒå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥' : 'Continue training failed, please check network connection', 'error');
            }
        }

        // ========== æ¨¡å‹ç®¡ç†åŠŸèƒ½ ==========
        async function loadModels() {
            const modelsList = document.getElementById('modelsList');
            if (!modelsList) return;

            try {
                // è·å–å½“å‰åˆ†ç±»
                let category = 'upper_limb';
                const categorySelect = document.getElementById('category');
                if (categorySelect && categorySelect.value) {
                    category = categorySelect.value;
                }
               
                const response = await fetch(`${API_BASE_URL}/models?category=${category}`);

                if (!response.ok) {
                    console.warn('è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
                    displayModelsList(getMockModels());
                    return;
                }

                const data = await response.json();

                if (data.models && Array.isArray(data.models)) {
                    displayModelsList(data.models);
                } else if (Array.isArray(data)) {
                    displayModelsList(data);
                } else {
                    console.warn('æœªçŸ¥çš„æ¨¡å‹åˆ—è¡¨æ ¼å¼ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
                    displayModelsList(getMockModels());
                }

            } catch (error) {
                console.error('åŠ è½½æ¨¡å‹åˆ—è¡¨é”™è¯¯:', error);
                displayModelsList(getMockModels());
            }
        }

        function displayModelsList(models) {
            const modelsList = document.getElementById('modelsList');
            const modelCount = document.getElementById('modelCount');
            
            if (!modelsList) return;

            if (!models || models.length === 0) {
                modelsList.innerHTML = `<div class="text-center py-8 text-white/60">${currentLanguage === 'zh-CN' ? 'æš‚æ— ä¿å­˜çš„æ¨¡å‹' : 'No saved models'}</div>`;
                if (modelCount) modelCount.textContent = '0';
                return;
            }

            if (modelCount) modelCount.textContent = models.length.toString();

            // æŒ‰åˆ›å»ºæ—¶é—´é™åºæ’åº
            models.sort((a, b) => {
                const getDate = m => {
                    let d = m.config?.training_date || m.created_at || m.training_date;
                    return d ? new Date(d).getTime() : 0;
                };
                return getDate(b) - getDate(a);
            });
            let html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
            models.forEach(model => {
                const modelName = model.name || model.model_name || (currentLanguage === 'zh-CN' ? 'æœªçŸ¥æ¨¡å‹' : 'Unknown Model');
                const modelCategory = model.category || (currentLanguage === 'zh-CN' ? 'æœªçŸ¥åˆ†ç±»' : 'Unknown Category');
                const createdDate = model.config?.training_date || model.created_at || model.training_date || (currentLanguage === 'zh-CN' ? 'æœªçŸ¥æ—¥æœŸ' : 'Unknown Date');
                const finalAccuracy = model.config?.final_accuracy || model.final_accuracy || model.accuracy;
                const finalLoss = model.config?.final_loss || model.final_loss || model.loss;
                html += `
                    <div class="bg-white/10 rounded-xl p-4 hover:bg-white/15 transition-all duration-300">
                        <div class="font-semibold text-lg mb-2 truncate" title="${modelName}">${modelName}</div>
                        <div class="text-sm opacity-80 mb-2">${currentLanguage === 'zh-CN' ? 'åˆ†ç±»' : 'Category'}: ${modelCategory}</div>
                        <div class="text-sm opacity-80 mb-3">${currentLanguage === 'zh-CN' ? 'åˆ›å»ºæ—¶é—´' : 'Created'}: ${formatDate(createdDate)}</div>
                        <div class="flex justify-between mb-3">
                            ${finalAccuracy ? `<div class="text-sm"><span class="opacity-80">${currentLanguage === 'zh-CN' ? 'å‡†ç¡®ç‡' : 'Accuracy'}:</span> <span class="font-semibold text-green-400">${(finalAccuracy * 100).toFixed(2)}%</span></div>` : ''}
                            ${finalLoss ? `<div class="text-sm"><span class="opacity-80">${currentLanguage === 'zh-CN' ? 'æŸå¤±' : 'Loss'}:</span> <span class="font-semibold text-red-400">${finalLoss.toFixed(4)}</span></div>` : ''}
                        </div>
                        <div class="flex gap-2">
                            <button onclick="showTrainingDetail('${modelCategory}', '${modelName}')" class="flex-1 py-2 px-3 bg-accent hover:bg-secondary text-white rounded text-sm transition-colors">
                                ${currentLanguage === 'zh-CN' ? 'è®­ç»ƒè¯¦æƒ…' : 'Training Details'}
                            </button>
                            <button onclick="publishModel('${modelCategory}','${modelName}')" class="py-2 px-3 bg-green-500 hover:bg-green-600 text-white rounded text-sm transition-colors">
                                ${currentLanguage === 'zh-CN' ? 'å‘å¸ƒ' : 'Publish'}
                            </button>
                            <button onclick="deleteModel('${modelCategory}','${modelName}')" class="py-2 px-3 bg-red-500 hover:bg-red-600 text-white rounded text-sm transition-colors">
                                ${currentLanguage === 'zh-CN' ? 'åˆ é™¤' : 'Delete'}
                            </button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            modelsList.innerHTML = html;
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            if (!dateString || dateString === (currentLanguage === 'zh-CN' ? 'æœªçŸ¥æ—¥æœŸ' : 'Unknown Date')) return currentLanguage === 'zh-CN' ? 'æœªçŸ¥æ—¥æœŸ' : 'Unknown Date';
            
            try {
                const date = new Date(dateString);
                return date.toLocaleString(currentLanguage === 'zh-CN' ? 'zh-CN' : 'en-US', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return dateString;
            }
        }

        function getMockModels() {
            return [
                {
                    name: 'upper_limb_model_v1',
                    category: 'upper_limb',
                    created_at: '2024-01-15 10:30:00',
                    final_accuracy: 0.92,
                    final_loss: 0.15
                },
                {
                    name: 'upper_limb_model_v2',
                    category: 'upper_limb',
                    created_at: '2024-01-20 14:45:00',
                    final_accuracy: 0.95,
                    final_loss: 0.12
                }
            ];
        }

        // ========== æ›´æ–°æ¨¡å‹åˆ—è¡¨å‡½æ•°ï¼ˆç”¨äºç»§ç»­è®­ç»ƒä¸‹æ‹‰æ¡†ï¼‰ ==========
        async function updateModelList() {
            const category = document.getElementById('continueCategory').value;
            const modelSelect = document.getElementById('continueModelName');
            
            if (!category) {
                modelSelect.innerHTML = `<option value="">-- ${currentLanguage === 'zh-CN' ? 'è¯·å…ˆé€‰æ‹©åˆ†ç±»' : 'Please select category first'} --</option>`;
                return;
            }

            try {
                // ä»æœåŠ¡å™¨è·å–æ¨¡å‹åˆ—è¡¨
                const response = await fetch(API_BASE_URL+'/models');
                
                if (!response.ok) {
                    console.warn('è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
                    populateModelSelect(getMockModels(), category, modelSelect);
                    return;
                }

                const data = await response.json();
                
                let models = [];
                if (data.models && Array.isArray(data.models)) {
                    models = data.models;
                } else if (Array.isArray(data)) {
                    models = data;
                } else {
                    console.warn('æœªçŸ¥çš„æ¨¡å‹åˆ—è¡¨æ ¼å¼ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
                    models = getMockModels();
                }
                
                populateModelSelect(models, category, modelSelect);

            } catch (error) {
                console.error('æ›´æ–°æ¨¡å‹åˆ—è¡¨é”™è¯¯:', error);
                populateModelSelect(getMockModels(), category, modelSelect);
            }
        }

        function populateModelSelect(models, category, modelSelect) {
            // è¿‡æ»¤æŒ‡å®šåˆ†ç±»çš„æ¨¡å‹
            const filteredModels = models.filter(model => model.category === category);
            modelSelect.innerHTML = `<option value="">-- ${currentLanguage === 'zh-CN' ? 'é€‰æ‹©æ¨¡å‹' : 'Select Model'} --</option>`;
            filteredModels.forEach(model => {
                const modelName = model.name || model.model_name || (currentLanguage === 'zh-CN' ? 'æœªçŸ¥æ¨¡å‹' : 'Unknown Model');
                const option = document.createElement('option');
                option.value = modelName;
                option.textContent = modelName;
                // é€æ˜èƒŒæ™¯ï¼Œç™½è‰²å­—ä½“
                option.style.background = 'rgba(0,0,0,0)';
                option.style.color = '#fff';
                modelSelect.appendChild(option);
            });
            if (filteredModels.length === 0) {
                modelSelect.innerHTML = `<option value="">-- ${currentLanguage === 'zh-CN' ? 'è¯¥åˆ†ç±»ä¸‹æ— æ¨¡å‹' : 'No models in this category'} --</option>`;
            }
            // é€æ˜èƒŒæ™¯ï¼Œç™½è‰²å­—ä½“
            modelSelect.style.background = 'rgba(0,0,0,0)';
            modelSelect.style.color = '#fff';
        }

        // ========== è®­ç»ƒè¯¦æƒ…åŠŸèƒ½ ==========
        async function showTrainingDetail(category, modelName) {
            try {
                const res = await fetch(`${API_BASE_URL}/model/${category}/${modelName}`);
                
                if (!res.ok) {
                    showMockTrainingDetail(category, modelName);
                    return;
                }

                const data = await res.json();
                
                if (data.error) {
                    showTemporaryMessage(data.error, 'error');
                    return;
                }
                
                const modelInfo = data.model_info || data;
                const trainingHistory = data.training_history || data.history;
                
                // æ›´æ–°æ¨¡æ€æ¡†å†…å®¹
                const modalModelInfo = document.getElementById('modalModelInfo');
                if (modalModelInfo) {
                    modalModelInfo.innerHTML = `
                        <div class="training-summary">
                            <div class="summary-item">
                                <div class="summary-value">${modelInfo.final_loss ? modelInfo.final_loss.toFixed(4) : 'N/A'}</div>
                                <div class="summary-label">${currentLanguage === 'zh-CN' ? 'æœ€ç»ˆæŸå¤±' : 'Final Loss'}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value">${modelInfo.final_accuracy ? (modelInfo.final_accuracy * 100).toFixed(2) + '%' : 'N/A'}</div>
                                <div class="summary-label">${currentLanguage === 'zh-CN' ? 'æœ€ç»ˆå‡†ç¡®ç‡' : 'Final Accuracy'}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value">${modelInfo.epochs || 'N/A'}</div>
                                <div class="summary-label">${currentLanguage === 'zh-CN' ? 'è®­ç»ƒè½®æ•°' : 'Training Epochs'}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value">${modelInfo.learning_rate || 'N/A'}</div>
                                <div class="summary-label">${currentLanguage === 'zh-CN' ? 'å­¦ä¹ ç‡' : 'Learning Rate'}</div>
                            </div>
                        </div>
                        <div style="padding: 20px;">
                            <h3 style="color: #333; margin-bottom: 10px;">${modelName} - ${category}</h3>
                            <p style="color: #666; margin-bottom: 5px;">${currentLanguage === 'zh-CN' ? 'è®­ç»ƒæ—¥æœŸ' : 'Training Date'}: ${modelInfo.training_date ? formatDate(modelInfo.training_date) : (currentLanguage === 'zh-CN' ? 'æœªçŸ¥' : 'Unknown')}</p>
                            <p style="color: #666; margin-bottom: 5px;">${currentLanguage === 'zh-CN' ? 'æ‰¹æ¬¡å¤§å°' : 'Batch Size'}: ${modelInfo.batch_size || (currentLanguage === 'zh-CN' ? 'æœªçŸ¥' : 'Unknown')}</p>
                            <p style="color: #666;">${currentLanguage === 'zh-CN' ? 'æ¨¡å‹æ¶æ„' : 'Model Architecture'}: ${modelInfo.model_architecture || (currentLanguage === 'zh-CN' ? 'æœªçŸ¥' : 'Unknown')}</p>
                        </div>
                    `;
                }
                
                // æ˜¾ç¤ºè®­ç»ƒå†å²æ•°æ®
                let historyHtml = '';
                
                if (trainingHistory && trainingHistory.loss && trainingHistory.loss.length > 0) {
                    historyHtml = `
                        <div style="padding: 20px;">
                            <h3 style="color: #333; margin-bottom: 15px;">${currentLanguage === 'zh-CN' ? 'è®­ç»ƒå†å²' : 'Training History'}</h3>
                            <div style="max-height: 400px; overflow-y: auto;">
                                <table class="training-history-table">
                                    <thead>
                                        <tr>
                                            <th>Epoch</th>
                                            <th>${currentLanguage === 'zh-CN' ? 'æŸå¤± (Loss)' : 'Loss'}</th>
                                            <th>${currentLanguage === 'zh-CN' ? 'å‡†ç¡®ç‡ (Accuracy)' : 'Accuracy'}</th>
                                            <th>${currentLanguage === 'zh-CN' ? 'æ—¶é—´æˆ³' : 'Timestamp'}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                    `;
                    
                    for (let i = 0; i < trainingHistory.loss.length; i++) {
                        const epoch = trainingHistory.epochs ? trainingHistory.epochs[i] : i + 1;
                        const loss = trainingHistory.loss[i];
                        const accuracy = trainingHistory.accuracy ? trainingHistory.accuracy[i] : 'N/A';
                        const timestamp = trainingHistory.timestamps ? trainingHistory.timestamps[i] : (currentLanguage === 'zh-CN' ? 'æœªçŸ¥' : 'Unknown');
                        
                        historyHtml += `
                            <tr>
                                <td>${epoch}</td>
                                <td>${loss.toFixed(4)}</td>
                                <td>${typeof accuracy === 'number' ? (accuracy * 100).toFixed(2) + '%' : accuracy}</td>
                                <td>${formatDate(timestamp)}</td>
                            </tr>
                        `;
                    }
                    
                    historyHtml += `
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                } else {
                    historyHtml = `<div style="padding: 20px; text-align: center; color: #666;">${currentLanguage === 'zh-CN' ? 'æš‚æ— è®­ç»ƒå†å²æ•°æ®' : 'No training history data'}</div>`;
                }
                
                const modalTrainingHistory = document.getElementById('modalTrainingHistory');
                if (modalTrainingHistory) {
                    modalTrainingHistory.innerHTML = historyHtml;
                }
                
                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                const modal = document.getElementById('trainingDetailModal');
                if (modal) {
                    modal.style.display = 'flex';
                }
                
            } catch (error) {
                console.error("è·å–è®­ç»ƒè¯¦æƒ…é”™è¯¯:", error);
                showMockTrainingDetail(category, modelName);
            }
        }

        function showMockTrainingDetail(category, modelName) {
            const modal = document.getElementById('trainingDetailModal');
            const modalModelInfo = document.getElementById('modalModelInfo');
            const modalTrainingHistory = document.getElementById('modalTrainingHistory');

            if (!modal || !modalModelInfo || !modalTrainingHistory) return;

            modalModelInfo.innerHTML = `
                <div class="training-summary">
                    <div class="summary-item">
                        <div class="summary-value">0.12</div>
                        <div class="summary-label">${currentLanguage === 'zh-CN' ? 'æœ€ç»ˆæŸå¤±' : 'Final Loss'}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">95.00%</div>
                        <div class="summary-label">${currentLanguage === 'zh-CN' ? 'æœ€ç»ˆå‡†ç¡®ç‡' : 'Final Accuracy'}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">50</div>
                        <div class="summary-label">${currentLanguage === 'zh-CN' ? 'è®­ç»ƒè½®æ•°' : 'Training Epochs'}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">0.001</div>
                        <div class="summary-label">${currentLanguage === 'zh-CN' ? 'å­¦ä¹ ç‡' : 'Learning Rate'}</div>
                    </div>
                </div>
                <div style="padding: 20px;">
                    <h3 style="color: #333; margin-bottom: 10px;">${modelName} - ${category}</h3>
                    <p style="color: #666; margin-bottom: 5px;">${currentLanguage === 'zh-CN' ? 'è®­ç»ƒæ—¥æœŸ' : 'Training Date'}: ${formatDate(new Date().toISOString())}</p>
                    <p style="color: #666; margin-bottom: 5px;">${currentLanguage === 'zh-CN' ? 'æ‰¹æ¬¡å¤§å°' : 'Batch Size'}: 8</p>
                    <p style="color: #666;">${currentLanguage === 'zh-CN' ? 'æ¨¡å‹æ¶æ„' : 'Model Architecture'}: Feature-based DNN</p>
                </div>
            `;

            modalTrainingHistory.innerHTML = `
                <div style="padding: 20px; text-align: center; color: #666;">
                    <p>${currentLanguage === 'zh-CN' ? 'åç«¯APIæš‚æ—¶ä¸å¯ç”¨ï¼Œæ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®' : 'Backend API is temporarily unavailable, showing mock data'}</p>
                    <p>${currentLanguage === 'zh-CN' ? 'è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼Œå¹¶åˆ·æ–°é¡µé¢é‡è¯•' : 'Please ensure the backend service is running and refresh the page to retry'}</p>
                </div>
            `;

            modal.style.display = 'flex';
        }

        function closeTrainingDetailModal() {
            const modal = document.getElementById('trainingDetailModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // ========== æ¨¡å‹åˆ é™¤åŠŸèƒ½ ==========
        async function deleteModel(category, modelName) {
            if (!confirm(`${currentLanguage === 'zh-CN' ? 'ç¡®å®šè¦åˆ é™¤æ¨¡å‹' : 'Are you sure you want to delete the model'} ${modelName} ${currentLanguage === 'zh-CN' ? 'å—ï¼Ÿ' : '?'}`)) {
                return;
            }
            try {
                const response = await fetch(`${API_BASE_URL}/model/${category}/${encodeURIComponent(modelName)}`, {
                    method: 'DELETE'
                });
                if (!response.ok) {
                    showTemporaryMessage(`${currentLanguage === 'zh-CN' ? 'åˆ é™¤å¤±è´¥' : 'Delete failed'}: ${response.status}`, 'error');
                    return;
                }
                let result = await response.json();
                if (!result.error) {
                    showTemporaryMessage(`${currentLanguage === 'zh-CN' ? 'æ¨¡å‹' : 'Model'} ${modelName} ${currentLanguage === 'zh-CN' ? 'åˆ é™¤æˆåŠŸ' : 'deleted successfully'}`, 'success');
                    await loadModels();
                    updateModelList();
                } else {
                    showTemporaryMessage(result.message || result.error || (currentLanguage === 'zh-CN' ? 'åˆ é™¤å¤±è´¥' : 'Delete failed'), 'error');
                }
            } catch (error) {
                console.error('åˆ é™¤æ¨¡å‹é”™è¯¯:', error);
                showTemporaryMessage(`${currentLanguage === 'zh-CN' ? 'åˆ é™¤å¤±è´¥' : 'Delete failed'}: ${error.message}`, 'error');
            }
        }

        // ========== å·¥å…·å‡½æ•° ==========
        // å‘å¸ƒæ¨¡å‹åˆ°åº·å¤é¡µé¢
        function publishModel(category, modelName) {
            // æ ‡è®°å‘å¸ƒæ¨¡å‹åˆ° localStorage
            localStorage.setItem('published_upper_limb_model', JSON.stringify({category, modelName}));
            showTemporaryMessage(`${currentLanguage === 'zh-CN' ? 'æ¨¡å‹' : 'Model'} ${modelName} ${currentLanguage === 'zh-CN' ? 'å·²å‘å¸ƒï¼Œå¯åœ¨åº·å¤é¡µé¢ä½¿ç”¨' : 'published, available on the rehabilitation page'}`, 'success');
        }
        function showTemporaryMessage(message, type = 'info') {
            const existingMessages = document.querySelectorAll('.temp-message');
            existingMessages.forEach(msg => msg.remove());

            const messageElement = document.createElement('div');
            messageElement.className = `temp-message ${type}`;
            messageElement.textContent = message;
            document.body.appendChild(messageElement);

            setTimeout(() => {
                if (messageElement.parentNode) {
                    messageElement.parentNode.removeChild(messageElement);
                }
            }, 3000);
        }

        // ========== é¡µé¢åˆå§‹åŒ– ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æ¨¡å‹è®­ç»ƒé¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–ç³»ç»Ÿ...');

            initLanguage();

            // è§£æURLå‚æ•°ï¼Œè‡ªåŠ¨é€‰æ‹©åº·å¤åˆ†ç±»
            function getQueryParam(name) {
                const url = window.location.href;
                name = name.replace(/[\[\]]/g, '\\$&');
                const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
                const results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, ' '));
            }
            const categorySelect = document.getElementById('category');
            let urlCategory = getQueryParam('category');
            if (categorySelect) {
                if (urlCategory && (urlCategory === 'lower_limb' || urlCategory === 'upper_limb' || urlCategory === 'aphasia')) {
                    categorySelect.value = urlCategory;
                } else {
                    categorySelect.value = 'upper_limb';
                }
            }

            // åˆå§‹åŒ–å›¾è¡¨
            initializeCharts();

            // åŠ è½½æ¨¡å‹åˆ—è¡¨
            loadModels();

            // æ›´æ–°æ¨¡å‹ä¸‹æ‹‰åˆ—è¡¨
            updateModelList();

            // é¦–æ¬¡è¿›å…¥é¡µé¢ï¼Œå³ä¸Šè§’æç¤ºä¸åŒåˆ†ç±»çš„æ•°æ®ç»Ÿè®¡
            setTimeout(async () => {
                try {
                    let category = 'upper_limb';
                    if (categorySelect && categorySelect.value) {
                        category = categorySelect.value;
                    }
                    const res = await fetch(`${API_BASE_URL}/pose_data_stats?category=${category}&detail=1`);
                    const data = await res.json();
                    if (data.status === 'error') return;
                    let msg = '';//`æ ·æœ¬æ€»æ•°ï¼š${data.total_samples || 0}   æ•°æ®æ–‡ä»¶æ•°ï¼š${data.total_files || 0}`;æ–‡ä»¶åç§°ï¼š${s.file_name || ''}ã€
                    if (data.latest_sample) {
                        const s = data.latest_sample;
                        msg += `\n${currentLanguage === 'zh-CN' ? 'æ£€æŸ¥åˆ°æœ€æ–°æ ·æœ¬ï¼ˆåŠ¨ä½œ' : 'Latest sample detected (action'}: ${s.action || ''}${currentLanguage === 'zh-CN' ? 'ã€æ ·æœ¬æ•°' : ', sample count'}: ${s.count || ''}ï¼‰`;
                    }
                    showTemporaryMessage(msg, 'info');
                } catch (e) {}
            }, 1000);

            console.log('æ¨¡å‹è®­ç»ƒç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
        });

        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            console.error('å…¨å±€é”™è¯¯:', e.error);
            showTemporaryMessage(currentLanguage === 'zh-CN' ? 'ç³»ç»Ÿå‘ç”Ÿé”™è¯¯ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°' : 'System error occurred, please check console', 'error');
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('æœªå¤„ç†çš„Promiseæ‹’ç»:', e.reason);
            showTemporaryMessage(currentLanguage === 'zh-CN' ? 'ç³»ç»Ÿå‘ç”Ÿé”™è¯¯ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°' : 'System error occurred, please check console', 'error');
        });
    </script>
</body>
</html>